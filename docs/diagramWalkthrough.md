# Making a diagram

To make a diagram you have to:

- specify which pins and components should be highlightable. This is done via
  specifying a simple YAML file.
- Build the diagram. This will generate a directory with several files.
- Embed it in your webpage/documentation.

## Basic concepts

Pinion consists of two parts - diagram generator `pinion` (that you run on your
computer) and a Javascript library that you include on your webpage, which
reads and displays the diagram (`pinion-widget`).

Pinion can highlight components and pins of components. Each of these objects
can have assigned a verbose description. This description is shown on mouse
hover/click. Each object can belong to any number of groups. The user has the
ability to highlight a given group.

## Defining a diagram

The diagram is specified via YAML file with the following structure:

```yaml
name: <name of the diagram>
description: <diagram description>
components: # A dictionary of component reference to component description
    <componentRef>:
        description: <component description>
        groups: <a list of groups>
        highlight: true/false
        pins: # A dictionary of pin names to pin description
            <pinName>:
                name: <human readable name of the pin>
                description: <pin description>
                alias: <pinName> # Use description of other pin. Alternative for description
                groups: <a list of groups>
groups: # An optional dictionary specifying tree structure of the groups, e.g.:
    Peripherals:
        - Adc
        - SPI
        - I2C
    Pins:
        - Digital
        - Analog
```

Note that you can use markdown in descriptions to make them pretty. You should
specify only the pins and components you want to be highlightable.

It you remember the [example diagram](alksStandalone.html), it was generated by
the [this YAML file](resources/alksSpec.yml).

To save you some typing, Pinion can generate a template for your. Simply invoke:

```
pinion template \
    --board <path to .kicad_pcb file> \
    --output <path to YAML file> \
    --components <comma separated list of component references>
```

Then you can modify the template as you need.

## Building the diagram

To build the diagram, simply invoke:

```
pinion generate \
    --board <path to .kicad_pcb file> \
    --specification <your YAML file> \
    <path to output directory>
```

This will generate all files required. Note that the board image is generated
via [PcbDraw](https://github.com/yaqwsx/PcbDraw). Therefore, if you struggle to
generate the board image correctly, try using PcbDraw directly first to locate
the issue.

That also means that you can pass PcbDraw options to `pinion generate` to e.g.,
remap your components, specify color scheme or point PcbDraw to the right
libraries. You read more about the details at [PcbDraw
documentation](https://github.com/yaqwsx/PcbDraw/blob/master/doc/pcbdraw.md).

The supported options are:
    - `--dpi` to specify image DPI
    - `--style` to specify style (i.e., color scheme)
    - `--libs` to specify the footprint library
    - `--remap` to remap component footprints
    - `--filter` to hide some footprint on the board.

The directory is the diagram specification that can be . Note that you can also
specify the option `--pack` that will include `pinion-widget` and a simple,
stand-alone page with the diagram. You should upload the entire directory on
your web page.

## Including the pinion widget on your webpage

Including pinion on a web page is simple. Just include the `pinion-widget`
script, stylesheets and set it up:

```html
<div id="pinionDemo"></div>

<script src="resources/pinion.js"></script>
<link rel="stylesheet" href="resources/pinion.css">

<script>
    pinion.setup(document.getElementById("pinionDemo"), {
        source: "resources/alksDemo"
    });
</script>
```

The first block creates a container in which we will the widget will be
included. It can be anywhere on the page. Note that we will later need to
reference this container, so we specify an id for it.

The second block loads pinion code and styles. You can either host these files
by yourself or use CDN (will be specified later). The precise location depends
on your setup.

In the third block, we start the widget. The first argument of `pinion.setup` is
the container for the widget and the second argument is a dictionary that
configures the widget. Currently, the only option is `source` that has to
contain a location to the source directory (note that it can also be an absolute
path).

And this is it. When you load your page, the diagram should be running!
